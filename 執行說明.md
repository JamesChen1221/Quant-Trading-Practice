# 程式執行說明

## ✅ 程式已更新完成

程式已調整為：
1. ✅ 讀取「量化交易.xlsx」檔案
2. ✅ 使用「資料庫」工作表
3. ✅ 自動讀取股票代碼和開盤日期
4. ✅ 計算 RSI/ADX 序列並直接填入對應欄位
5. ✅ 保留所有其他工作表（如「資料定義」）

## 📊 RSI/ADX 計算說明

### 資料來源
- **使用 yfinance 套件**從 Yahoo Finance 抓取美股歷史股價
- 包含：開盤價、最高價、最低價、收盤價、成交量

### 計算參數
- **n = 14**（業界標準）
  - RSI 週期：14 天
  - ADX 週期：14 天

### 計算方式

#### RSI (相對強弱指標)
```
1. 計算每日價格變動
2. 分離上漲和下跌
3. 計算 14 天平均漲幅和跌幅
4. RS = 平均漲幅 / 平均跌幅
5. RSI = 100 - (100 / (1 + RS))
```

#### ADX (平均趨向指標)
```
1. 計算真實波幅 (TR)
2. 計算方向移動 (+DM, -DM)
3. 計算方向指標 (+DI, -DI)
4. 計算方向指標差 (DX)
5. ADX = DX 的 14 天移動平均
```

詳細技術說明請參考：**技術說明_RSI_ADX計算.md**

## 🚀 執行程式

```cmd
python calculate_indicators.py
```

程式會：
1. 讀取「量化交易.xlsx」的「資料庫」工作表
2. 逐行處理每個股票代碼
3. 從 Yahoo Finance 下載股價資料
4. 計算 RSI 和 ADX 序列
5. 將結果寫回原檔案

## ⚠️ 重要注意事項

### 關於日期設定

目前「資料庫」中的日期是 **2026-02-05**（今天），這會導致：

❌ **問題**：無法獲取「開盤日期之後」的資料
- 程式需要計算開盤日期**之後** 5 天和 30 天的 RSI/ADX
- 但今天之後的資料還不存在
- 結果會是空序列 `[]`

✅ **解決方法**：使用歷史日期

建議將開盤日期改為至少 **30 個交易日之前**的日期，例如：
- `2025-12-01`（約 2 個月前）
- `2026-01-01`（約 1 個月前）
- `2025-11-01`（約 3 個月前）

### 範例測試

如果你想測試程式，可以：

1. **修改 Excel 中的日期**：
   - 將「開盤日期(台灣時間)」改為 `2025-12-15`
   - 這樣程式可以抓取 12/15 之後的資料

2. **或使用熱門股票測試**：
   ```
   公司代碼: NVDA, AAPL, TSLA, MSFT
   開盤日期: 2025-12-01
   ```

3. **執行程式**：
   ```cmd
   python calculate_indicators.py
   ```

4. **查看結果**：
   - 開啟「量化交易.xlsx」
   - 查看「資料庫」工作表
   - 檢查「5天 RSI 序列」等欄位

## 📝 輸出格式

結果會以字串格式儲存在 Excel 中：

```
5天 RSI 序列: [46.69, 40.43, 32.07, 43.58, 47.51]
5天 ADX 序列: [28.39, 27.57, 28.36, 28.37, 27.95]
1個月 RSI 序列: [46.69, 40.43, ..., 52.31]
1個月 ADX 序列: [28.39, 27.57, ..., 31.45]
```

## 🔧 自訂設定

如果需要修改參數，編輯 `calculate_indicators.py`：

### 修改計算週期
```python
# 修改 RSI 週期（預設 14）
df["RSI"] = calculate_rsi(df["Close"], period=14)

# 修改 ADX 週期（預設 14）
df["ADX"] = calculate_adx(df["High"], df["Low"], df["Close"], period=14)
```

### 修改序列長度
```python
def calculate_rsi_adx_sequences(ticker, start_date, days_5=5, days_30=30):
    # days_5: 改為其他天數（如 3, 7, 10）
    # days_30: 改為其他天數（如 20, 60, 90）
```

## 📚 相關檔案

- **calculate_indicators.py** - 主程式
- **技術說明_RSI_ADX計算.md** - 詳細的計算公式和邏輯
- **使用說明.md** - 一般使用說明
- **量化交易.xlsx** - 資料檔案（包含「資料定義」和「資料庫」兩個工作表）

## 💡 建議工作流程

1. **準備資料**：
   - 在「資料庫」工作表中填入股票代碼
   - 設定開盤日期（建議使用歷史日期）

2. **執行計算**：
   ```cmd
   python calculate_indicators.py
   ```

3. **檢查結果**：
   - 開啟 Excel 查看計算結果
   - 確認序列長度和數值合理

4. **分析資料**：
   - 使用 RSI 判斷超買超賣
   - 使用 ADX 判斷趨勢強度
   - 結合其他指標進行量化分析

## ❓ 常見問題

### Q: 為什麼結果是空序列 `[]`？
A: 開盤日期可能是今天或未來日期，請改為歷史日期。

### Q: 為什麼只有部分資料？
A: 開盤日期之後的交易日可能不足 30 天，程式會計算可用的資料。

### Q: 可以修改計算週期嗎？
A: 可以，修改 `calculate_rsi()` 和 `calculate_adx()` 中的 `period` 參數。

### Q: 支援台股嗎？
A: 目前只支援美股代號（如 NVDA, AAPL），不支援台股代號（如 2330）。

### Q: 資料會覆蓋原檔案嗎？
A: 是的，程式會直接更新「量化交易.xlsx」的「資料庫」工作表，但會保留其他工作表。
