# RVOL (相對成交量) 計算說明

## 📊 什麼是 RVOL？

**RVOL (Relative Volume)** 是相對成交量指標，用於衡量當前成交量相對於歷史平均成交量的比例。

### 公式

```
RVOL = 當日成交量 / 過去 N 天平均成交量
```

預設使用 **N = 5 天**（過去 5 個交易日的平均成交量）

---

## 🎯 RVOL 的意義

### 數值解讀

| RVOL 值 | 意義 | 說明 |
|---------|------|------|
| **> 2.0** | 極高成交量 | 成交量是平均的 2 倍以上，可能有重大消息 |
| **1.5 - 2.0** | 高成交量 | 成交量明顯高於平均，市場關注度高 |
| **1.0 - 1.5** | 正常偏高 | 成交量略高於平均 |
| **0.8 - 1.0** | 正常 | 成交量接近平均水平 |
| **< 0.8** | 低成交量 | 成交量低於平均，市場興趣不高 |

### 實際範例

從測試結果來看：

```
TER:  RVOL = 2.06  → 極高成交量（2倍以上）
PLTR: RVOL = 1.67  → 高成交量
LITE: RVOL = 1.30  → 正常偏高
KMT:  RVOL = 2.09  → 極高成交量（2倍以上）
```

---

## 💡 RVOL 的應用

### 1. 確認突破有效性

- **高 RVOL + 價格突破** = 突破可能有效
- **低 RVOL + 價格突破** = 突破可能無效（假突破）

### 2. 識別重大事件

- RVOL > 2.0 通常表示有重大消息（財報、新聞等）
- 可以結合其他指標判斷方向

### 3. 盤前交易分析

- 盤前 RVOL 高 → 開盤可能有大波動
- 盤前 RVOL 低 → 開盤可能平淡

### 4. 趨勢確認

- **上漲 + 高 RVOL** = 強勢上漲
- **上漲 + 低 RVOL** = 弱勢上漲（可能反轉）
- **下跌 + 高 RVOL** = 強勢下跌
- **下跌 + 低 RVOL** = 弱勢下跌（可能反彈）

---

## 🔧 程式實作

### 計算邏輯

```python
def calculate_rvol(volume_series, period=5):
    """
    計算相對成交量 (RVOL)
    
    RVOL = 當日成交量 / 過去 N 天平均成交量
    
    參數:
        volume_series: 成交量序列
        period: 計算平均的天數（預設 5 天）
    
    返回:
        RVOL 序列
    """
    avg_volume = volume_series.rolling(window=period).mean()
    rvol = volume_series / avg_volume
    return rvol
```

### 資料來源

- 使用 `yfinance` 下載股票資料
- 取得 `Volume` 欄位（成交量）
- 計算開盤日當天的 RVOL

### 計算步驟

1. **下載歷史資料**
   ```python
   df = yf.download("NVDA", start="2025-11-01", end="2026-02-05")
   ```

2. **計算 5 天平均成交量**
   ```python
   avg_volume = df["Volume"].rolling(window=5).mean()
   ```

3. **計算 RVOL**
   ```python
   rvol = df["Volume"] / avg_volume
   ```

4. **取得開盤日當天的 RVOL**
   ```python
   rvol_current = rvol.loc[start_date]
   ```

---

## 📝 使用方式

### 自動計算

執行主程式時會自動計算 RVOL：

```bash
python calculate_indicators.py
```

程式會：
1. 讀取股票代碼和開盤日期
2. 下載歷史成交量資料
3. 計算開盤日當天的 RVOL
4. 寫入「相對成交量 (RVOL)」欄位

### 輸出格式

RVOL 以數值形式儲存在 Excel 中：

| 公司代碼 | 相對成交量 (RVOL) |
|---------|------------------|
| TER     | 2.056282         |
| PLTR    | 1.674492         |
| LITE    | 1.295720         |
| KMT     | 2.088419         |

---

## 🎯 實戰範例

### 範例 1：TER (RVOL = 2.06)

```
開盤日期: 2026-02-03
RVOL: 2.06（極高成交量）
RSI: 78.52（超買）

分析：
- 成交量是平均的 2 倍以上
- RSI 顯示超買
- 可能有重大消息或財報
- 需要注意回調風險
```

### 範例 2：PLTR (RVOL = 1.67)

```
開盤日期: 2026-02-03
RVOL: 1.67（高成交量）
RSI: 29.81（接近超賣）

分析：
- 成交量明顯高於平均
- RSI 接近超賣區
- 可能是恐慌性賣出
- 可以關注反彈機會
```

### 範例 3：LITE (RVOL = 1.30)

```
開盤日期: 2025-02-04
RVOL: 1.30（正常偏高）
RSI: 51.13（中性）

分析：
- 成交量略高於平均
- RSI 中性
- 市場關注度一般
- 可能是正常交易日
```

---

## ⚙️ 自訂設定

### 修改計算週期

如果想使用不同的天數計算平均成交量：

```python
# 在 calculate_indicators.py 中修改
df["RVOL"] = calculate_rvol(df["Volume"], period=10)  # 改為 10 天
```

常用週期：
- **5 天**：短期（預設）
- **10 天**：中期
- **20 天**：長期

---

## 📊 與其他指標結合

### RVOL + RSI

```
高 RVOL + 超買 RSI → 可能見頂
高 RVOL + 超賣 RSI → 可能見底
低 RVOL + 任何 RSI → 趨勢不明確
```

### RVOL + ADX

```
高 RVOL + 高 ADX → 強趨勢確認
高 RVOL + 低 ADX → 可能是震盪
低 RVOL + 高 ADX → 趨勢減弱
```

### RVOL + 價格變動

```
高 RVOL + 大漲 → 強勢上漲
高 RVOL + 大跌 → 強勢下跌
低 RVOL + 小漲小跌 → 盤整
```

---

## 🔍 注意事項

### 1. 特殊情況

- **財報日**：RVOL 通常會很高（> 2.0）
- **重大新聞**：RVOL 會突然飆高
- **假期前後**：RVOL 可能異常低

### 2. 盤前 vs 盤中

- 程式計算的是**開盤日當天的 RVOL**
- 如果是盤前資料，需要另外處理
- 盤中 RVOL 會隨時間變化

### 3. 不同市場

- 美股：RVOL 通常在 0.5 - 2.0 之間
- 小型股：RVOL 波動較大
- 大型股：RVOL 較穩定

### 4. 資料品質

- 確保成交量資料完整
- 節假日可能影響計算
- 停牌日需要特別處理

---

## 📚 參考資料

- **計算週期**：預設 5 天（可調整）
- **資料來源**：Yahoo Finance
- **更新頻率**：每次執行程式時更新

---

## 🎉 總結

RVOL 是一個簡單但強大的指標：

✅ **優點**
- 計算簡單
- 容易理解
- 實用性高
- 可以結合其他指標

✅ **應用場景**
- 確認突破有效性
- 識別重大事件
- 判斷趨勢強度
- 盤前交易分析

✅ **程式功能**
- 自動計算
- 保留格式
- 增量更新
- 結果清晰

現在你的量化交易系統又多了一個強大的工具！🚀
