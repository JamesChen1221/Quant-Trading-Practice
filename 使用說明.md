# 美股當沖量化交易 - RSI & ADX 計算程式

## 功能說明

這個程式可以自動讀取 Excel 表格中的股票代碼和開盤日期，計算技術指標並寫回表格：

- **5 天 RSI 序列**：從開盤日期開始的 5 個交易日 RSI 值
- **1 個月 RSI 序列**：從開盤日期開始的 30 個交易日 RSI 值
- **5 天 ADX 序列**：從開盤日期開始的 5 個交易日 ADX 值
- **1 個月 ADX 序列**：從開盤日期開始的 30 個交易日 ADX 值

## 檔案說明

1. **calculate_indicators.py** - 主程式
2. **create_sample_data.py** - 創建範例資料檔案
3. **requirements.txt** - 必要套件清單
4. **交易資料範例.xlsx** - 範例資料檔案
5. **交易資料_結果.xlsx** - 計算結果檔案

## 安裝步驟

1. 安裝必要套件：
```cmd
pip install yfinance pandas openpyxl
```

或使用 requirements.txt：
```cmd
pip install -r requirements.txt
```

## 使用方法

### 方法一：使用範例資料測試

1. 創建範例資料：
```cmd
python create_sample_data.py
```

2. 執行計算：
```cmd
python calculate_indicators.py
```

3. 查看結果：開啟 `交易資料_結果.xlsx`

### 方法二：使用自己的資料

1. 準備你的 Excel 檔案，必須包含以下欄位：
   - `開盤日期(台灣時間)` - 格式：YYYY-MM-DD
   - `公司代碼` - 美股代號（如：NVDA, AAPL, TSLA）

2. 修改 `calculate_indicators.py` 最後幾行：
```python
if __name__ == "__main__":
    input_file = "你的檔案.xlsx"  # 改成你的檔案名稱
    output_file = "結果檔案.xlsx"  # 改成你想要的輸出檔案名稱
    
    process_excel_file(input_file, output_file)
```

3. 執行程式：
```cmd
python calculate_indicators.py
```

## Excel 欄位格式

程式會自動在以下欄位寫入計算結果：
- `5天 RSI 序列`
- `1個月 RSI 序列`
- `5天 ADX 序列`
- `1個月 ADX 序列`

如果這些欄位不存在，程式會自動創建。

## 範例輸出

```
公司代碼: NVDA
開盤日期: 2026-01-15
5天 RSI 序列: [46.69, 40.43, 32.07, 43.58, 47.51]
5天 ADX 序列: [28.39, 27.57, 28.36, 28.37, 27.95]
```

## 技術指標說明

### RSI (相對強弱指標)
- 計算週期：14 天
- 數值範圍：0-100
- 超買：> 70
- 超賣：< 30

### ADX (平均趨向指標)
- 計算週期：14 天
- 數值範圍：0-100
- 強趨勢：> 25
- 弱趨勢：< 20

## 注意事項

1. **日期限制**：由於範例使用的是未來日期（2026年），實際資料可能不足。請使用歷史日期進行測試。

2. **資料來源**：程式使用 yfinance 從 Yahoo Finance 下載股票資料，需要網路連線。

3. **交易日計算**：程式會自動處理非交易日（週末、假日），只計算實際交易日的指標。

4. **資料不足警告**：如果開盤日期之後的交易日不足 30 天，程式會顯示警告但仍會計算可用的資料。

5. **股票代碼**：請使用美股代號（如 NVDA, AAPL），不支援台股代號。

## 自訂選項

### 修改計算週期

在 `calculate_indicators.py` 中修改：

```python
# 修改 RSI 週期（預設 14）
df["RSI"] = calculate_rsi(df["Close"], period=14)

# 修改 ADX 週期（預設 14）
df["ADX"] = calculate_adx(df["High"], df["Low"], df["Close"], period=14)
```

### 修改序列長度

在 `calculate_rsi_adx_sequences` 函數中修改：

```python
def calculate_rsi_adx_sequences(ticker, start_date, days_5=5, days_30=30):
    # days_5: 短期序列長度（預設 5 天）
    # days_30: 長期序列長度（預設 30 天）
```

### 覆蓋原檔案

如果想直接覆蓋原檔案而不創建新檔案：

```python
process_excel_file(input_file, output_file=None)
```

## 疑難排解

### 問題：找不到欄位
**解決方法**：確認 Excel 檔案中有 `開盤日期(台灣時間)` 和 `公司代碼` 欄位。

### 問題：下載資料失敗
**解決方法**：
1. 檢查網路連線
2. 確認股票代碼正確
3. 確認日期不是未來日期

### 問題：計算結果為空
**解決方法**：
1. 確認開盤日期之後有足夠的交易日資料
2. 使用歷史日期而非未來日期

## 聯絡與支援

如有問題或建議，請參考程式碼中的註解或修改相關參數。
