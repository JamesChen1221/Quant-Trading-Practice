# 盤前成交量輸入指南

## ⚠️ 重要澄清

### yfinance 的限制

**yfinance 無法獲取任何盤前成交量資料**，包括：
- ❌ 當日盤前成交量
- ❌ 過去任何一天的盤前成交量

yfinance 只能獲取**全日成交量**（正常交易時段 9:30 AM - 4:00 PM ET）

---

## 📝 你需要手動輸入的資料

### 完整的資料需求

要計算正確的盤前 RVOL，你需要在 Excel 中輸入：

```
✓ 今日（2026-02-03）的盤前成交量
✓ 過去第1天（2026-01-31）的盤前成交量
✓ 過去第2天（2026-01-30）的盤前成交量
✓ 過去第3天（2026-01-29）的盤前成交量
✓ 過去第4天（2026-01-28）的盤前成交量
✓ 過去第5天（2026-01-27）的盤前成交量
```

### 計算邏輯

```
過去 5 日平均盤前量 = (第1天 + 第2天 + 第3天 + 第4天 + 第5天) / 5

盤前 RVOL = 今日盤前量 / 過去 5 日平均盤前量
```

---

## 📊 Excel 資料結構範例

### 正確的資料格式

| 開盤日期(台灣時間) | 公司代碼 | 盤前成交量 | 相對成交量 (RVOL) |
|-------------------|---------|-----------|------------------|
| 2026-01-27 | NVDA | 2000000 | (自動計算) |
| 2026-01-28 | NVDA | 2500000 | (自動計算) |
| 2026-01-29 | NVDA | 1800000 | (自動計算) |
| 2026-01-30 | NVDA | 2200000 | (自動計算) |
| 2026-01-31 | NVDA | 2100000 | (自動計算) |
| **2026-02-03** | **NVDA** | **15000000** | **7.14** ← 今日 |

### 計算過程

```
過去 5 日平均 = (2000000 + 2500000 + 1800000 + 2200000 + 2100000) / 5
              = 10600000 / 5
              = 2120000

今日 RVOL = 15000000 / 2120000 = 7.08
```

---

## 🔧 使用步驟

### 步驟 1：準備歷史資料

在 Excel 中為每支股票建立至少 6 天的資料（包含今日）：

```excel
開盤日期(台灣時間) | 公司代碼 | 盤前成交量
2026-01-27        | NVDA    | 2000000
2026-01-28        | NVDA    | 2500000
2026-01-29        | NVDA    | 1800000
2026-01-30        | NVDA    | 2200000
2026-01-31        | NVDA    | 2100000
2026-02-03        | NVDA    | 15000000  ← 今日
```

### 步驟 2：填入盤前成交量

從你的資料源獲取盤前成交量：

**資料來源選項：**
1. 券商平台（TD Ameritrade, IBKR, Webull）
2. Yahoo Finance 網頁版
3. MarketWatch
4. TradingView
5. Investing.com

### 步驟 3：執行程式

```bash
python calculate_indicators.py
```

### 步驟 4：查看結果

程式會：
1. 偵測到「盤前成交量」欄位
2. 自動計算過去 5 日平均
3. 計算盤前 RVOL
4. 填入結果

---

## 💡 實際範例

### 範例 1：NVDA 財報日

#### 輸入資料

| 日期 | 公司代碼 | 盤前成交量 |
|------|---------|-----------|
| 2026-01-27 | NVDA | 2,000,000 |
| 2026-01-28 | NVDA | 2,500,000 |
| 2026-01-29 | NVDA | 1,800,000 |
| 2026-01-30 | NVDA | 2,200,000 |
| 2026-01-31 | NVDA | 2,100,000 |
| **2026-02-03** | **NVDA** | **15,000,000** |

#### 計算結果

```
過去 5 日平均 = 2,120,000
今日盤前量 = 15,000,000
盤前 RVOL = 15,000,000 / 2,120,000 = 7.08

解讀：
- 盤前 RVOL 7.08 倍（極高）
- 可能是財報日或重大消息
- 開盤預期有大波動
```

### 範例 2：AAPL 正常交易日

#### 輸入資料

| 日期 | 公司代碼 | 盤前成交量 |
|------|---------|-----------|
| 2026-01-27 | AAPL | 3,000,000 |
| 2026-01-28 | AAPL | 2,800,000 |
| 2026-01-29 | AAPL | 3,200,000 |
| 2026-01-30 | AAPL | 2,900,000 |
| 2026-01-31 | AAPL | 3,100,000 |
| **2026-02-03** | **AAPL** | **3,500,000** |

#### 計算結果

```
過去 5 日平均 = 3,000,000
今日盤前量 = 3,500,000
盤前 RVOL = 3,500,000 / 3,000,000 = 1.17

解讀：
- 盤前 RVOL 1.17 倍（正常偏高）
- 沒有特別消息
- 開盤預期平穩
```

---

## 🎯 程式執行輸出

### 有完整盤前資料

```
正在讀取 量化交易.xlsx 的 '資料庫' 工作表...
✓ 偵測到「盤前成交量」欄位，將使用盤前成交量計算 RVOL

處理第 6 筆: NVDA (日期: 2026-02-03)
  正在下載 NVDA 的資料...
  ✓ 完成 (實際資料: 48 天)
  RSI 5天前3筆: [73.66, 82.7, 68.51]
  RVOL: 7.08 (盤前成交量)  ← 使用盤前資料
```

### 缺少歷史盤前資料

```
處理第 1 筆: NVDA (日期: 2026-02-03)
  正在下載 NVDA 的資料...
    ⚠ 警告: 找不到過去 5 天的盤前成交量資料
  ⚠ 無法計算盤前 RVOL，使用全日成交量替代
  ✓ 完成 (實際資料: 48 天)
  RSI 5天前3筆: [73.66, 82.7, 68.51]
  RVOL: 2.06 (全日成交量)  ← 使用全日資料（僅供參考）
```

---

## 📋 資料收集工作流程

### 每日工作流程

#### 早上（盤前結束後）

```
1. 開啟券商平台或財經網站
2. 查看目標股票的盤前成交量
3. 記錄數據：
   - NVDA: 15,000,000
   - AAPL: 3,500,000
   - TSLA: 8,200,000
```

#### 填入 Excel

```
4. 開啟 量化交易.xlsx
5. 在「資料庫」工作表中新增今日資料
6. 填入：
   - 開盤日期(台灣時間): 2026-02-03
   - 公司代碼: NVDA
   - 盤前成交量: 15000000
```

#### 執行計算

```
7. 執行程式：
   python calculate_indicators.py

8. 查看結果：
   - RVOL 已自動計算
   - 結合 RSI、ADX 做決策
```

---

## ⚠️ 常見問題

### Q1: 我只輸入今日盤前量，程式能自動抓取過去 5 天嗎？

**A: 不能。** yfinance 無法獲取任何盤前成交量資料。你需要手動輸入所有相關日期的盤前成交量。

### Q2: 如果我只有 3 天的歷史資料怎麼辦？

**A: 程式會顯示警告，但仍會計算。** 建議至少有 5 天的歷史資料以獲得準確的 RVOL。

```
⚠ 警告: 只有 3 天的歷史盤前成交量（建議至少 5 天）
RVOL: 2.5 (基於 3 天平均)
```

### Q3: 不同股票需要分別輸入嗎？

**A: 是的。** 每支股票都需要自己的歷史盤前成交量資料。

```
NVDA: 需要 6 天資料（5 天歷史 + 今日）
AAPL: 需要 6 天資料（5 天歷史 + 今日）
TSLA: 需要 6 天資料（5 天歷史 + 今日）
```

### Q4: 週末和假日怎麼處理？

**A: 只計算交易日。** 程式會自動跳過週末和假日，只使用有盤前成交量的交易日。

### Q5: 可以使用 API 自動獲取嗎？

**A: 可以，但需要付費服務。** 參考 [盤前RVOL說明.md](盤前RVOL說明.md) 中的 API 選項。

---

## 🔍 資料來源指南

### 免費資源（手動查詢）

#### 1. Yahoo Finance 網頁版

```
1. 訪問 https://finance.yahoo.com/quote/NVDA
2. 查看 "Pre-Market" 區域
3. 記錄 "Volume" 數值
```

#### 2. MarketWatch

```
1. 訪問 https://www.marketwatch.com/investing/stock/nvda
2. 查看盤前交易資訊
3. 記錄成交量
```

#### 3. 券商平台

- **TD Ameritrade**: thinkorswim 平台
- **Interactive Brokers**: TWS 平台
- **Webull**: 手機 App 或網頁版

### 付費資源（API 自動化）

#### 1. Polygon.io ($29/月)

```python
import requests

API_KEY = "your_api_key"
symbol = "NVDA"
date = "2026-02-03"

# 獲取盤前資料（4:00 AM - 9:30 AM ET）
url = f"https://api.polygon.io/v2/aggs/ticker/{symbol}/range/1/minute/{date}/{date}"
```

#### 2. Alpha Vantage ($49.99/月)

```python
import requests

API_KEY = "your_api_key"
symbol = "NVDA"

# 獲取分鐘級資料，篩選盤前時段
url = f"https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol={symbol}&interval=1min&apikey={API_KEY}"
```

---

## 📊 Excel 範本

### 建議的資料結構

```excel
| 開盤日期(台灣時間) | 公司代碼 | 盤前成交量 | 相對成交量 (RVOL) | 5天 RSI 序列 | ... |
|-------------------|---------|-----------|------------------|-------------|-----|
| 2026-01-27        | NVDA    | 2000000   |                  |             |     |
| 2026-01-28        | NVDA    | 2500000   |                  |             |     |
| 2026-01-29        | NVDA    | 1800000   |                  |             |     |
| 2026-01-30        | NVDA    | 2200000   |                  |             |     |
| 2026-01-31        | NVDA    | 2100000   |                  |             |     |
| 2026-02-03        | NVDA    | 15000000  | 7.08 (自動)      | (自動)      |     |
```

### 下載範本

執行以下程式建立範本：

```bash
python create_template.py
```

---

## 🎉 總結

### 關鍵要點

1. ❌ **yfinance 無法獲取盤前成交量**（包括歷史資料）
2. ✅ **需要手動輸入所有相關日期的盤前成交量**
3. ✅ **程式會自動計算過去 5 日平均和 RVOL**
4. ⚠️ **至少需要 6 天的資料**（5 天歷史 + 今日）

### 建議做法

**短期（立即可用）：**
- 每天手動查詢並輸入盤前成交量
- 建立 Excel 資料庫
- 執行程式計算 RVOL

**長期（自動化）：**
- 訂閱 Polygon.io 或其他資料服務
- 開發自動化腳本
- 建立完整的資料管道

---

**相關文件：**
- [盤前RVOL說明.md](盤前RVOL說明.md) - 詳細說明和 API 選項
- [RVOL計算說明.md](RVOL計算說明.md) - 一般 RVOL 說明
- [範例資料說明.md](範例資料說明.md) - Excel 結構說明
