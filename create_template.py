"""
建立量化交易 Excel 範本檔案

執行此腳本會建立一個空白的 量化交易.xlsx 檔案，
包含所有必要的欄位和工作表結構。
"""

import pandas as pd
from datetime import datetime

def create_template():
    """建立 Excel 範本檔案"""
    
    # 定義所有欄位
    columns = [
        '開盤日期(台灣時間)', 
        '公司代碼', 
        '產業', 
        '盤前漲幅 (%)', 
        '相對成交量 (RVOL)', 
        '5日高價距離 (%)', 
        '5日低價距離 (%)', 
        '1個月高價距離 (%)', 
        '1個月低價距離 (%)', 
        '5天 RSI 序列',  # 程式自動填入
        '5天 ADX 序列',  # 程式自動填入
        '1個月 RSI 序列',  # 程式自動填入
        '1個月 ADX 序列',  # 程式自動填入
        '觸發類型', 
        '消息情緒分數', 
        '備註', 
        'EPS Surprise (%)', 
        'Revenue Surprise (%)', 
        '展望 (Guidance)', 
        '開盤價變動 (%)', 
        '10分鐘洗盤深度 (%)', 
        '2小時獲利潛力 (%)', 
        '2小時風險回撤 (%)', 
        '2小時結束漲跌 (%)'
    ]
    
    # 建立空白資料框
    df_database = pd.DataFrame(columns=columns)
    
    # 建立資料定義工作表
    df_definition = pd.DataFrame({
        '類別': [
            '基本資訊', '', '',
            '盤前動能', '',
            '技術位階', '', '', '',
            '短期趨勢', '',
            '長期趨勢', '',
            '驅動因子',
            '消息', '',
            '財報細節', '', '',
            '目標', '', '', ''
        ],
        '欄位名稱': [
            '開盤日期(台灣時間)', '公司代碼', '產業',
            '盤前漲幅 (%)', '相對成交量 (RVOL)',
            '5日高價距離 (%)', '5日低價距離 (%)', '1個月高價距離 (%)', '1個月低價距離 (%)',
            '5天 RSI 序列', '5天 ADX 序列',
            '1個月 RSI 序列', '1個月 ADX 序列',
            '觸發類型',
            '消息情緒分數', '備註',
            'EPS Surprise (%)', 'Revenue Surprise (%)', '展望 (Guidance)',
            '開盤價變動 (%)', '10分鐘洗盤深度 (%)', '2小時獲利潛力 (%)', '2小時風險回撤 (%)', '2小時結束漲跌 (%)'
        ],
        '計算方式 / 儲存格式': [
            'YYYY-MM-DD', '股票代號 (如: AAPL, 2330)', '類別型編碼 (如: 1=半導體, 2=科技)',
            '(盤前價 / 昨收 - 1) * 100', '今日盤前量 / 過去 5 日平均盤前量',
            '(盤前價 / 5日最高 - 1) * 100', '(盤前價 / 5日最高 - 1) * 100',
            '(盤前價 / 20日最高 - 1) * 100', '(盤前價 / 20日最高 - 1) * 100',
            '[d1, d2, d3, d4, d5]', '[d1, d2, d3, d4, d5]',
            '[d1, d2, ..., d20]', '[d1, d2, ..., d20]',
            '1=財報, 2=消息, 3=兩者',
            '數值 -1.0 (極差) 到 +1.0 (極佳)', '文字敘述',
            '(實際 EPS - 預期) / 預期 * 100', '(實際營收 - 預期) / 預期 * 100', '1=調升, 0=持平, -1=調降',
            '(正式開盤價 / 盤前價 - 1) * 100', '(開盤10分最低 / 開盤價 - 1) * 100',
            '(開盤2小時最高 / 開盤價 - 1) * 100', '(開盤2小時最低 / 開盤價 - 1) * 100',
            '(開盤2小時價格 / 開盤價 - 1) * 100'
        ]
    })
    
    # 儲存為 Excel
    filename = '量化交易.xlsx'
    with pd.ExcelWriter(filename, engine='openpyxl') as writer:
        # 寫入資料定義工作表
        df_definition.to_excel(writer, sheet_name='資料定義', index=False)
        
        # 寫入資料庫工作表
        df_database.to_excel(writer, sheet_name='資料庫', index=False)
    
    print(f"✓ 已建立 {filename}")
    print(f"✓ 包含 2 個工作表：「資料定義」和「資料庫」")
    print(f"✓ 共 {len(columns)} 個欄位")
    print(f"\n下一步：")
    print(f"1. 開啟 {filename}")
    print(f"2. 在「資料庫」工作表中填入股票代碼和開盤日期")
    print(f"3. 執行 python calculate_indicators.py")

if __name__ == "__main__":
    create_template()
